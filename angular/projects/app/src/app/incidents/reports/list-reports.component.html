<router-outlet></router-outlet>
<shared-command-header [class.d-none]="route.firstChild">
  <a class="command-header__plain" (click)="onDone()">Done</a>
  <ul class="nav">
    <li class="nav__item">
      <a class="nav__link" [class.nav__link--active]="view === 'cards'" (click)="view = 'cards'" tabindex="0">Cards</a>
    </li>
    <li class="nav__item">
      <a class="nav__link" [class.nav__link--active]="view === 'table'" (click)="view = 'table'" tabindex="0">Table</a>
    </li>
  </ul>
  <a class="command-header__plain" download="reports.csv" [href]="'/api/reports?incidentId=' + incidentId + '&format=csv'">Export</a>
</shared-command-header>
<main [class.d-none]="route.firstChild">
  <div *ngIf="view === 'table'" class="table-responsive">
    <table class="table">
      <tr *ngFor="let report of reports" [routerLink]="['/incidents', incidentId, 'reports', report.id]">
        <td>#{{ report.pin }}</td>
        <td>
          {{ report.description }}
        </td>
        <td>
          {{ report.updatedAtRelative }}
        </td>
        <td>
          {{ report.narrative?.text }}
        </td>
        <td>
          <div *ngFor="let file of report.files; let i = index">
            <audio *ngIf="file.fileUrl" [src]="file.fileUrl" controls></audio>
          </div>
        </td>
        <td>
          <shared-triage-priority-chip class="mb-1" [priority]="report.filterPriority"></shared-triage-priority-chip>
          <shared-triage-priority-chip
            *ngIf="report.filterPriority === 5"
            [priority]="report.patient?.priority"></shared-triage-priority-chip>
        </td>
      </tr>
    </table>
  </div>
  <div *ngIf="view === 'cards'" class="reports">
    <div *ngFor="let report of reports" [routerLink]="['/incidents', incidentId, 'reports', report.id]" class="reports__report">
      <ng-container *ngIf="!!report.scene?.isMCI">
        <h3>#{{ report.pin }}</h3>
        <div class="reports__chips">
          <shared-triage-priority-chip class="mb-1" [priority]="report.filterPriority"></shared-triage-priority-chip>
          <shared-triage-priority-chip
            *ngIf="report.filterPriority === 5"
            [priority]="report.patient?.priority"></shared-triage-priority-chip>
        </div>
        <dl>
          <dd>{{ report.description }}</dd>
          <hr />
          <dd class="fs-5">{{ report.updatedAtRelative }}</dd>
        </dl>
      </ng-container>
      <ng-container *ngIf="!report.scene?.isMCI">
        <h3>Unit #: {{ report.response.unitNumber }}</h3>
        <dl>
          <dt>Age:</dt>
          <dd>{{ report.patient.ageString }}</dd>
          <hr />
          <dt>Gender:</dt>
          <dd>{{ report.patient.genderString }}</dd>
        </dl>
      </ng-container>
    </div>
    <div *ngIf="reports?.length === 0">
      <h3>No reports yet.</h3>
    </div>
  </div>
</main>
